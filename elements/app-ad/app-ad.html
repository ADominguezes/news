<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script>

  (function() {

    'use strict';

    document.registerElement('app-ad', {
      prototype: {

        __proto__: HTMLElement.prototype,

        createdCallback: function() {
          this.style.display = 'inline-block';
          this.style.position = 'relative';
          this.style.overflow = 'hidden';
          //this._adUrl = (location.hostname === 'localhost' ? location.origin : 'https://polymer-ads.appspot.com') + '/elements/app-ad';
          this._adUrl = location.origin + '/elements/app-ad';
        },

        attachedCallback: function() {
          this.config = {};
          var attr;
          for (var i=0; i < this.attributes.length; i++) {
            attr = this.attributes[i];
            if (attr.name === 'type') {
              this.type = attr.value;
            } else if (attr.name === 'style' || attr.name === 'class') {
            } else if (attr.name === 'preload') {
              this._preloadIframe();
            } else {
              this.config[attr.name] = attr.value;
            }
          }
        },

        attributeChangedCallback: function(attr) {
          if (attr === 'preload') {
            this._preloadIframe();
          }
        },

        _preloadIframe: function() {
          if (this._iframe) {
            return;
          }
          this._iframe = document.createElement('iframe');
          this._iframe.style.cssText = 'position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: 100%; height: 100%; border: 0;';
          this._iframe.src = this._adUrl + '/' + this.type + '.html?' + JSON.stringify(this.config);
          this.appendChild(this._iframe);
        }

      }
    });

  })();

</script>
